// -----
// Part of the One-Page Checkout plugin, provided under GPL 2.0 license by lat9.
// Copyright (C) 2013-2019, Vinos de Frutas Tropicales.  All rights reserved.
//
var selected,submitter=null;function concatExpiresFields(e){return jQuery(":input[name="+e[0]+"]").val()+jQuery(":input[name="+e[1]+"]").val()}function popupWindow(e){window.open(e,"popupWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=450,height=320,screenX=150,screenY=150,top=150,left=150")}function couponpopupWindow(e){window.open(e,"couponpopupWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=450,height=320,screenX=150,screenY=150,top=150,left=150")}function submitonce(){var e=document.getElementById("btn_submit");return e.style.cursor="wait",e.disabled=!0,setTimeout("button_timeout()",4e3),!1}function button_timeout(){var e=document.getElementById("btn_submit");e.style.cursor="pointer",e.disabled=!1}function zcLog2Console(e){window.console&&"function"==typeof console.log&&console.log(e)}function submitFunction(e,o){var t=arguments.length;submitter=null;for(var n="",r=0;r<t;r++)n+=arguments[r]+", ";if(zcLog2Console("submitFunction, "+t+" arguments: "+n),2==t){var i=document.getElementById("ottotal"),c=0;"DIV"!=i.tagName&&(c=1);var u=i.children[c].textContent.substr(1);if(zcLog2Console("Current order total: "+u+", text: "+i.children[c].textContent),document.getElementById("current-order-total").value=i.children[c].textContent,0==u)zcLog2Console("Order total is 0, setting submitter"),submitter=1;else{var a=[].slice.call(document.querySelectorAll("[id^=disc-]"));for(r=0;r<a.length;r++)""!=a[r].value&&(submitter=1);var s=document.getElementsByName("cot_gv");0!=s.length&&(zcLog2Console("Checking ot_gv value ("+s[0].value+") against order total ("+u+")"),s[0].value>=u&&(submitter=1))}}zcLog2Console("submitFunction, on exit submitter="+submitter)}function methodSelect(e){document.getElementById(e)&&(document.getElementById(e).checked="checked")}function setJavaScriptEnabled(){var e=document.getElementById("javascript-enabled");e&&(e.value="1")}var orderConfirmed=0;function setOrderConfirmed(e){orderConfirmed=e,jQuery("#confirm-the-order").val(e),zcLog2Console("Setting orderConfirmed ("+e+"), submitter ("+submitter+")")}jQuery(document).ready(function(){var e=!1;0==jQuery('form[name="checkout_payment"]').length&&(e=!0,zcLog2Console('Missing form[name="checkout_payment"]')),0==jQuery("#orderTotalDivs").length&&(e=!0,zcLog2Console("Missing #orderTotalDivs"));var o=!0;function t(){jQuery("#checkoutOneShipto").length&&(jQuery("#shipping_billing").is(":checked")?jQuery("#checkoutOneShipto").hide():jQuery("#checkoutOneShipto").show())}function i(){var e=null;if(document.checkout_payment.payment)if(document.checkout_payment.payment.length)for(var o=0;o<document.checkout_payment.payment.length;o++)document.checkout_payment.payment[o].checked&&(e=document.checkout_payment.payment[o].value);else document.checkout_payment.payment.checked?e=document.checkout_payment.payment.value:document.checkout_payment.payment.value&&(e=document.checkout_payment.payment.value);zcLog2Console("setFormSubmitButton, payment-module: "+e),jQuery("#opc-order-review, #opc-order-confirm").hide(),null==e||-1==confirmation_required.indexOf(e)?(jQuery("#opc-order-confirm").show(),zcLog2Console('Showing "confirm"')):(jQuery("#opc-order-review").show(),zcLog2Console('Showing "review"'))}function c(){var e=jQuery("#checkoutShippingMethod").offset().top;jQuery(window).scrollTop(e)}displayShippingBlock||(o=!1,jQuery("#checkoutShippingMethod").hide(),jQuery("#otshipping").hide(),jQuery("#otshipping+br").hide()),displayPaymentBlock||(o=!1,jQuery("#checkoutPaymentMethod").hide()),o&&(0==jQuery("#current-order-total").length&&(e=!0,zcLog2Console("Missing #current-order-total")),0==jQuery("#opc-order-confirm").length&&(e=!0,zcLog2Console("Missing #opc-order-confirm")),0==jQuery("#opc-order-review").length&&(e=!0,zcLog2Console("Missing #opc-order-review"))),virtual_order||0==jQuery("#otshipping").length&&(e=!0,zcLog2Console("Missing #otshipping")),e&&alert("Please contact the store owner; some required elements of this page are missing."),t(),setJavaScriptEnabled(),jQuery(document).on("keypress",":input:not(textarea)",function(e){return 13!=e.keyCode}),i(),setOrderConfirmed(0),jQuery("#checkoutOneShippingFlag").show(),zcLog2Console("jQuery version: "+jQuery().jquery),collectsCardDataOnsite=function(t){return zcLog2Console("Checking collectsCardDataOnsite("+t+") ..."),zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=doesCollectsCardDataOnsite",data:{paymentValue:t}}).done(function(e){if(1==e.data){zcLog2Console(" ... it does!");var o=jQuery('form[name="checkout_payment"]').serializeArray();zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=prepareConfirmation",data:o}).done(function(e){jQuery("#checkoutPayment").hide(),jQuery("#navBreadCrumb").html(e.breadCrumbHtml),jQuery("#checkoutPayment").before(e.confirmationHtml),jQuery(document).attr("title",e.pageTitle),jQuery(document).scrollTop(0),-1==confirmation_required.indexOf(t)?(zcLog2Console('Preparing to submit form, since confirmation is not required for "'+t+'", per the required list: "'+confirmation_required),jQuery("#checkoutOneLoading").show(),jQuery('form[name="checkout_confirmation"]')[0].submit()):(zcLog2Console("Confirmation required, displaying for "+t+"."),jQuery("#checkoutConfirmDefault").show())})}else zcLog2Console(" ... it does not, submitting."),jQuery('form[name="checkout_payment"]')[0].submit()}),!1};var n=null;function y(e){"timeout"==e&&(alert(sessionTimeoutErrorMessage),jQuery(location).attr("href",timeoutUrl)),"unavailable"==e&&(alert(ajaxNotAvailableMessage),jQuery(location).attr("href",checkoutShippingUrl))}function u(n){var e=jQuery("input[name=shipping]");if(e.is(":radio")&&(e=jQuery("input[name=shipping]:checked")),0==e.length&&"shipping-billing"!=n)alert(noShippingSelectedError),c();else{e=e.val();var r=jQuery("#shipping_billing").is(":checked"),o=jQuery("input[name=payment]");o.is(":radio")&&(o=jQuery("input[name=payment]:checked")),o=0==o.length?"":o.val();var t={shipping:e,shipping_is_billing:r,shipping_request:n,payment:o};0!=additionalShippingInputs.length&&(jQuery.each(additionalShippingInputs,function(e,o){shippingInputs[e]=jQuery('input[name="'+o.input_name+'"]'+o.parms).val()}),t=jQuery.extend(t,shippingInputs)),zcLog2Console("Updating shipping method to "+e+", processing type: "+n),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=updateShipping",data:t,timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage),shippingError=!0}}).done(function(e){y(e.status),jQuery("#orderTotalDivs").html(e.orderTotalHtml),"submit"!=n&&("refresh"==e.paymentHtmlAction?window.location.reload(!0):"update"==e.paymentHtmlAction&&(jQuery("#checkoutPaymentMethod").replaceWith(e.paymentHtml),jQuery("input[name=payment]").on("change",function(){i()})));var o=!1;if(jQuery("#otshipping, #otshipping+br").show(),"ok"==e.status?"shipping-billing"==n&&(r&&window.location.reload(!0),jQuery("#checkoutShippingChoices").html(e.shippingHtml),jQuery("#checkoutShippingContentChoose").html(e.shippingMessage),jQuery("#checkoutShippingChoices").on("click","input[name=shipping]",function(e){u("shipping-only")})):(o=!0,"invalid"==e.status&&("shipping-billing"==n?window.location.reload(!0):(jQuery("#checkoutShippingMethod input[name=shipping]").prop("checked",!1),jQuery("#checkoutShippingChoices").html(e.shippingHtml),jQuery("#checkoutShippingChoices").on("click","input[name=shipping]",function(e){u("shipping-only")}),jQuery("#otshipping, #otshipping+br").hide(),c())),""!=e.errorMessage&&("submit"==n||"shipping-billing"==n&&"invalid"!=e.status||"submit-cc"==n)&&alert(e.errorMessage)),zcLog2Console("Shipping method updated, error: "+o),"submit"==n||"submit-cc"==n)if(1==o)zcLog2Console("Shipping error, correct to proceed.");else if(zcLog2Console("Form submitted, type ("+n+"), orderConfirmed ("+orderConfirmed+")"),"submit-cc"==n)jQuery('form[name="checkout_payment"]').submit();else if(orderConfirmed&&(jQuery("#confirm-order").attr("disabled",!0),flagOnSubmit)){var t=check_form();zcLog2Console("Form checked, passed ("+t+")"),t&&(jQuery("#confirm-order").attr("disabled",!1),jQuery('form[name="checkout_payment"]').submit())}})}}function r(e,o){zcLog2Console("useSelectedAddress("+e+", "+o+")"),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=setAddressFromSavedSelections",data:{which:e,address_id:o},timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage)}}).done(function(e){location.reload()})}function a(e){jQuery(this).addClass("opc-changed"),jQuery("#checkoutOneBillto .opc-buttons").show(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneBillto").addClass("opc-view")}function s(){m("bill","#checkoutOneBillto"),jQuery("#checkoutPayment > .opc-overlay").removeClass("active"),jQuery("#checkoutOneBillto").removeClass("opc-view"),jQuery("#checkoutOneBillto .opc-buttons").hide()}function l(){g("bill","#checkoutOneBillto")}function p(e){jQuery(this).addClass("opc-changed"),jQuery("#checkoutOneShipto .opc-buttons").show(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneShipto").removeClass("visibleField"),jQuery("#checkoutOneShipto").addClass("opc-view")}function d(){m("ship","#checkoutOneShipto"),jQuery("#checkoutPayment > .opc-overlay").removeClass("active"),jQuery("#checkoutOneShipto").removeClass("opc-view"),jQuery("#checkoutOneShipto .opc-buttons").hide()}function h(){g("ship","#checkoutOneShipto")}function m(o,t){zcLog2Console("restoreAddressValues("+o+", "+t+")"),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=restoreAddressValues",data:{which:o},timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage)}}).done(function(e){y(e.status),jQuery(t).replaceWith(e.addressHtml),"undefined"!=typeof initializeStateZones&&initializeStateZones(),"ship"==o?(jQuery(document).on("change","#checkoutOneShipto input, #checkoutOneShipto select:not(#select-address-ship)",p),jQuery(document).on("click","#opc-ship-cancel",d),jQuery(document).on("click","#opc-ship-save",h)):(jQuery(document).on("change","#checkoutOneBillto input, #checkoutOneBillto select:not(#select-address-bill)",a),jQuery(document).on("click","#opc-bill-cancel",s),jQuery(document).on("click","#opc-bill-save",l))})}function g(r,o){zcLog2Console("saveAddressValues("+r+", "+o+")");var e=jQuery('input[name="gender['+r+']"]:checked').val(),t=jQuery('input[name="company['+r+']"]').val(),n=jQuery('input[name="firstname['+r+']"]').val(),i=jQuery('input[name="lastname['+r+']"]').val(),c=jQuery('input[name="street_address['+r+']"]').val(),u=jQuery('input[name="suburb['+r+']"]').val(),a=jQuery('input[name="city['+r+']"]').val(),s=jQuery('input[name="state['+r+']"]').val(),l=jQuery('select[name="zone_id['+r+']"] option:selected').val(),p=jQuery('input[name="postcode['+r+']"]').val(),d=jQuery('select[name="zone_country_id['+r+']"] option:selected').val(),h=jQuery("#shipping_billing").is(":checked"),m=jQuery("#opc-add-"+r).prop("checked");zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=validateAddressValues",data:{which:r,gender:e,company:t,firstname:n,lastname:i,street_address:c,suburb:u,city:a,state:s,zone_id:l,postcode:p,zone_country_id:d,shipping_billing:h,add_address:m},timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage)}}).done(function(e){y(e.status);var t="#messages-"+r;if(0!=e.messages.length){var n=!1;jQuery(t).html("<ul></ul>").addClass("opc-error"),jQuery(o+" input, "+o+" select").removeClass("opc-error"),jQuery.each(e.messages,function(e,o){jQuery(t+" ul").append("<li>"+o+"</li>"),jQuery('input[name="'+e+"["+r+']"]').length?(jQuery('input[name="'+e+"["+r+']"]').addClass("opc-error").removeClass("opc-changed"),n||(n=!0,jQuery('input[name="'+e+"["+r+']"]').focus())):(jQuery('select[name="'+e+"["+r+']"]').addClass("opc-error").removeClass("opc-changed"),n||(n=!0,jQuery('select[name="'+e+"["+r+']"]').focus()))})}else window.location.reload(!0)})}doesCollectsCardDataOnsite=function(e){return zcLog2Console("Checking doesCollectsCardDataOnsite("+e+") ..."),jQuery("#"+e+"_collects_onsite").val()&&jQuery("#pmt-"+e).is(":checked")?(zcLog2Console("... it does!"),n=e,!0):(zcLog2Console("... it does not."),n=null,!1)},doCollectsCardDataOnsite=function(){var e=jQuery('form[name="checkout_payment"]').serializeArray();zcLog2Console("doCollectsCardDataOnsite for "+n),zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=prepareConfirmation",data:e}).done(function(e){jQuery("#checkoutPayment").hide(),jQuery("#navBreadCrumb").html(e.breadCrumbHtml.replace(/\.ready/g,".ajaxComplete")),jQuery("#checkoutPayment").before(e.confirmationHtml.replace(/\.ready/g,".ajaxComplete")),jQuery(document).attr("title",e.pageTitle),jQuery(document).scrollTop(0),-1==confirmation_required.indexOf(n)?(zcLog2Console('Preparing to submit form, since confirmation is not required for "'+n+'", per the required list: "'+confirmation_required),jQuery("#checkoutOneLoading").show(),jQuery("#checkoutConfirmationDefault").hide(),jQuery(document).ajaxComplete(function(){jQuery('form[name="checkout_confirmation"]')[0].submit()})):(zcLog2Console("Confirmation required, displaying for "+n+"."),jQuery("#checkoutConfirmDefault").show())})},jQuery(document).ajaxStart(function(){jQuery("*").css("cursor","wait")}),jQuery(document).ajaxStop(function(){jQuery("*").css("cursor","")}),jQuery("#checkoutShippingMethod input[name=shipping]").on("click",function(e){u("shipping-only")}),jQuery("#shipping_billing").on("click",function(e){t(),u("shipping-billing")}),jQuery(".opc-cc-submit").on("click",function(e){zcLog2Console("Submitting credit-class request"),setOrderConfirmed(0),u("submit-cc")}),jQuery("input[name=payment]").on("change",function(){i();var e=jQuery("input[name=payment]");e.is(":radio")&&(e=jQuery("input[name=payment]:checked"));var o={payment:e=0==e.length?"":e.val()};zcLog2Console("Updating payment method to "+e),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=updatePaymentMethod",data:o,timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage)}}).done(function(e){y(e.status),jQuery("#orderTotalDivs").html(e.orderTotalHtml)})}),jQuery("#opc-order-review, #opc-order-confirm").on("click",function(e){submitFunction(0,0),setOrderConfirmed(1),zcLog2Console("Submitting order-creating form"),u("submit")}),jQuery(document).on("change","#select-address-bill",function(e){r("bill",this.value)}),jQuery(document).on("change","#select-address-ship",function(e){r("ship",this.value)}),jQuery(document).on("change","#checkoutOneBillto input, #checkoutOneBillto select:not(#select-address-bill)",a),jQuery(document).on("click","#opc-bill-cancel",s),jQuery(document).on("click","#opc-bill-save",l),jQuery(document).on("change","#checkoutOneShipto input, #checkoutOneShipto select:not(#select-address-ship)",p),jQuery(document).on("click","#opc-ship-cancel",d),jQuery(document).on("click","#opc-ship-save",h),jQuery("#checkoutPaymentNoJs").hide(),jQuery("#checkoutPayment").show();var j=!0;jQuery("#checkoutOneGuestInfo").find("input").each(function(){if(jQuery(this).prop("required")&&""==jQuery(this).val())return jQuery("#checkoutOneGuestInfo .opc-buttons").show(),jQuery("#opc-guest-cancel").hide(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneGuestInfo").addClass("opc-view"),jQuery(this).focus(),j=!1}),j&&jQuery("#checkoutOneBillto").find("input").each(function(){if(jQuery(this).prop("required")&&""==jQuery(this).val())return jQuery("#checkoutOneBillto .opc-buttons").show(),jQuery("#opc-bill-cancel").hide(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneBillto").addClass("opc-view"),jQuery(this).focus(),!1}),jQuery(document).on("change","#checkoutOneGuestInfo input",function(e){jQuery(this).addClass("opc-changed"),jQuery("#checkoutOneGuestInfo .opc-buttons").show(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneGuestInfo").addClass("opc-view")}),jQuery(document).on("click","#opc-guest-cancel",function(e){zcLog2Console("restoreCustomerInfo, starts ..."),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=restoreCustomerInfo",timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage)}}).done(function(e){y(e.status),jQuery("#checkoutOneGuestInfo").html(e.infoHtml)}),jQuery("#checkoutPayment > .opc-overlay").removeClass("active"),jQuery("#checkoutOneGuestInfo").removeClass("opc-view"),jQuery("#checkoutOneGuestInfo .opc-buttons").hide()}),jQuery(document).on("click","#opc-guest-save",function(e){zcLog2Console("saveCustomerInfo, starts ..."),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=validateCustomerInfo",data:jQuery("#checkoutOneGuestInfo input, #checkoutOneGuestInfo select").serialize(),timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutErrorMessage)}}).done(function(e){y(e.status);var t="#messages-guest";if(0!=e.messages.length){var n=!1;jQuery(t).html("<ul></ul>").addClass("opc-error"),jQuery("#checkoutOneGuestInfo input").removeClass("opc-error"),jQuery.each(e.messages,function(e,o){jQuery(t+" ul").append("<li>"+o+"</li>"),jQuery('input[name="'+e+'"]').length&&(jQuery('input[name="'+e+'"]').addClass("opc-error").removeClass("opc-changed"),n||(n=!0,jQuery('input[name="'+e+'"]').focus()))})}else window.location.reload(!0)})})});